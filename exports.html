<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Icon made by Twitter -->
        <!-- https://twemoji.twitter.com/content/twemoji-twitter/en.html -->
        <link rel="icon" href="./robot-face.png">
        <link rel="apple-touch-icon" href="./robot-face.png">

        <meta name="generator" content="hakyll">
        <meta name="language" content="English">
        
        <meta name="keywords" content="dataliberation infra pkm">
        
        <!-- TODO concat with keywords tags; also need to make comma separated? -->

        <title>Building personal data export infrastructure | Mildly entertainingᵝ</title>

        <link href="https://fonts.googleapis.com/css?family=Source+Serif+Pro" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="./css/default.css?v=3" />
        <link rel="stylesheet" href="./css/links.css?v=4" />

        
    </head>
    <body>
        <header>
            <nav>
                <span class="nav-left">
                    <a class="fat" href="./">Home</a>
                    <!-- TODO eh, not sure if this symbol is good for that... -->
                    ·
                    <a class="fat" href="./ideas.html">Ideas</a>
                    ·
                    <a class="fat" href="./notes.html">Notes</a>
                    ·
                    <a class="fat" href="./tags.html">Tags</a>
                </span>
                <span class="nav-right">
                    <a class="fat" href="./feed.html">Feed</a>
                    ·
                    <a class="fat" href="./site.html">Site</a>
                    ·
                    <a class="fat" href="./me.html">Me</a>
                </span>
            </nav>
        </header>

        <main>
            

<!-- <link rel="stylesheet" href="/css/org.css" /> -->

<link rel="stylesheet" href="./css/htmlize.css" />
<link rel="stylesheet" href="./css/org-default.css" />

<link rel="stylesheet" href="./css/org-extra.css?v=3" />



<article>
    
    <div>THIS IS A DRAFT! It will appear on the main page once finished!</div>
    
    <section class="post-title">
    <h1>Building personal data export infrastructure</h1>
    <div class="summary">How too liberate your data with minimal effort (TODO now?)minimal effort (TODO now?)</h2>
    </section>
    <!-- are sections appropriate for that? -->

    <section class="content">
    <p>
Our personal data is trapped, siloed and very hard to access for various reasons. I wrote a lot about in the <a href="sad-infra.html">previous post</a>.
</p>
<p>
As I promised, this post will be somewhat more specific. I will be presenting different technical challenges, patterns TODO had to overcome while developing my export infrastructure.
</p>
<p>
In hindsight some things feel so obvious that they hardly deserve mention, but I hope that would be helpful anyway!
</p>
<p>
For many services that I use I didn't manage to find existing solutions for exporting all my data so had to implement my own.
That however gave me opportunity to develop some common pattens.
</p>
<p>
TODO I'm kind of implementing 'data mirror' (it doesn't exist and more of a concept)
TODO consider it on some specific example?
</p>
<p>
What is my goal? Having my personal data (TODO) synchronised on my file system, periodically and reliably; and having programmatic access to it.
</p>
<p>
That is not that hard to achieve for one particular data source, but when you want to use ten or more, each having its own quirks it becomes TODO pain? to manage so you might want to TODO
</p>
<p>
So, in this post I'm simply going to explain how I've achieved that kind of system for myself and elaborate on patterns, code organization TODO and tricks.
</p>
<p>
That said, I'm happy to hear your questions "Why did or did not you do X instead?", it's quite possible that I'm slipping extra complexity somewhere and I would be happy to eliminate it.
</p>
<p>
TODO refer to it as 'data liberation'?
</p>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0000000">1. Design principles</a>
<ul>
<li><a href="#org0000001"><span class="todo TODO">TODO</span> could experiment with some diagram?? E.g. GDPR export for github events + periodic exports?</a></li>
</ul>
</li>
<li><a href="#org0000002">2. Retrieving data</a>
<ul>
<li><a href="#org0000003">public API</a></li>
<li><a href="#org0000004">private API</a></li>
<li><a href="#org0000005">scraping</a></li>
<li><a href="#org0000006">manual export (GDPR/takeout)</a></li>
<li><a href="#org0000007"><span class="todo TODO">TODO</span> phones and devices?</a></li>
</ul>
</li>
<li><a href="#org0000008">3. Types of exports</a>
<ul>
<li><a href="#org0000009">full export</a></li>
<li><a href="#org000000a">incremental export</a></li>
<li><a href="#org000000b">synthetic export</a></li>
</ul>
</li>
<li><a href="#org000000c">4. Export layer</a>
<ul>
<li><a href="#org000000d">use existing bindings</a></li>
<li><a href="#org000000e"><span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:22]</span></span> allow reading credentials from a file</a></li>
<li><a href="#org000000f">do not be too defensive</a></li>
<li><a href="#org0000010">output to stdout if feasible (e.g. json/csv)</a></li>
<li><a href="#org0000011"><span class="todo TODO">TODO</span> not sure how ot integrate timestamps here? maybe separate export wrapper in a separate file?</a></li>
<li><a href="#org0000012">backup wrapper</a></li>
</ul>
</li>
<li><a href="#org0000013">5. <span class="todo TODO">TODO</span> Running/scheduling exports etc?</a>
<ul>
<li><a href="#org0000014"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 00:59]</span></span> going to overlap with data organization bit?</a></li>
<li><a href="#org0000015"><span class="todo TODO">TODO</span> suggest using fcron?   <span class="tag"><span class="exports">exports</span></span></a></li>
</ul>
</li>
<li><a href="#org0000016">6. Data organization: how to keep it</a>
<ul>
<li><a href="#org0000017"><span class="todo TODO">TODO</span> <span class="priority">[D]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 22:43]</span></span> bleanser kind of fits here?</a></li>
<li><a href="#org0000018"><span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:56]</span></span> some exceptions: Google takeout – at the moment I just (TODO sift) them now and then</a></li>
<li><a href="#org0000019"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:57]</span></span> compression – bwrapper</a></li>
<li><a href="#org000001a"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-09-30 22:01]</span></span> why not borg?</a></li>
<li><a href="#org000001b"><span class="timestamp-wrapper"><span class="timestamp">[2019-12-28 23:57]</span></span> mention that the only acceptable date/time format is some variation of YYYY MM DD HH MM SS Z</a></li>
<li><a href="#org000001c"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-09-29 23:30]</span></span> write about bwrapper?</a></li>
</ul>
</li>
<li><a href="#org000001d">7. Data access layer (DAL)</a>
<ul>
<li><a href="#org000001e"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> would be nice to have main for models?   <span class="tag"><span class="dataliberation">dataliberation</span></span></a></li>
<li><a href="#org000001f"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> do simple html dashboards for each exporter?   <span class="tag"><span class="dataliberation">dataliberation</span></span></a></li>
<li><a href="#org0000020"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> take single path as argument? or maybe glob=true?   <span class="tag"><span class="dataliberation">dataliberation</span></span></a></li>
<li><a href="#org0000021"><span class="todo TODO">TODO</span> it's also an experiment in organizing code. demo etc, immediately visualize stuff with pandas   <span class="tag"><span class="exports">exports</span> <span class="blog">blog</span> <span class="dal">dal</span></span></a></li>
</ul>
</li>
<li><a href="#org0000022">8. Similar projects</a>
<ul>
<li><a href="#org0000023">perkeep</a></li>
<li><a href="#org0000024"><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2018-09-18 02:13]</span></span> Perkeep lets you permanently keep your stuff, for life. /r/selfhosted   <span class="tag"><span class="pkm">pkm</span></span></a></li>
<li><a href="#org0000025"><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-23 16:21]</span></span> Perkeep: personal storage system for life | Hacker News   <span class="tag"><span class="graspw">graspw</span> <span class="pkm">pkm</span></span></a></li>
<li><a href="#org0000026"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-22 16:19]</span></span> perkeep   <span class="tag"><span class="gr">gr</span></span></a></li>
<li><a href="#org0000027"><span class="todo TODO">TODO</span> <span class="priority">[A]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-15 21:31]</span></span> Digital Tools I Wish Existed | Hacker News   <span class="tag"><span class="perkeep">perkeep</span></span></a></li>
<li><a href="#org0000028"><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-23 16:19]</span></span> Perkeep – Open-source data modeling, storing, search, sharing and synchronizing | Hacker News   <span class="tag"><span class="graspw">graspw</span> <span class="pkm">pkm</span></span></a></li>
</ul>
</li>
<li><a href="#org0000029">9. Integrate</a>
<ul>
<li><a href="#org000002a"><span class="todo TODO">TODO</span> idempotence</a></li>
<li><a href="#org000002b"><span class="todo TODO">TODO</span> why it's hard: you can't find dummy/mock data to test on   <span class="tag"><span class="exports">exports</span></span></a></li>
<li><a href="#org000002c"><span class="todo TODO">TODO</span> example of mad auth: endomondo code (user agent etc)   <span class="tag"><span class="exports">exports</span></span></a></li>
<li><a href="#org000002d"><span class="todo TODO">TODO</span> in order to preserve sanity, serializing needs to be paired with deserializing, that's the main motivation for DAL   <span class="tag"><span class="exports">exports</span> <span class="blog">blog</span></span></a></li>
<li><a href="#org000002e"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:24]</span></span> potential idea: some sort of community supported sandbox allowing to manage tokens and exposing them in code/files, showing expiry times etc</a></li>
<li><a href="#org000002f"><span class="todo TODO">TODO</span> Incremental backups</a></li>
<li><a href="#org0000030"><span class="todo TODO">TODO</span> have a suggestion for #begin<sub>xxx</sub> thing to take in html tags?</a></li>
</ul>
</li>
<li><a href="#org0000031">10. <span class="todo TODO">TODO</span> https://stackoverflow.com/questions/15431044/can-i-set-max-retries-for-requests-request   <span class="tag"><span class="exports">exports</span></span></a></li>
<li><a href="#org0000032">11. example of synthetic: browser export   <span class="tag"><span class="exports">exports</span></span></a></li>
<li><a href="#org0000033">12. <span class="todo TODO">TODO</span> CCPA? wonder if it's similar to GDPR   <span class="tag"><span class="exports">exports</span></span></a></li>
<li><a href="#org0000034">13. <span class="todo TODO">TODO</span> resue existing libraries as far as possible (both for exporting and as a means of DAL), e.g. monzo example</a></li>
<li><a href="#org0000035">14. <span class="todo TODO">TODO</span> separation of concernts. it's annoying to take care about file names/dates/atomicity in individual scripts</a></li>
<li><a href="#org0000036">15. <span class="todo TODO">TODO</span> would be nice to update metadata if possible? some fields could be marked as such and allowed to update</a></li>
<li><a href="#org0000037">16. <span class="todo TODO">TODO</span> Why do I need file output for export helper?   <span class="tag"><span class="exports">exports</span></span></a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0000000">
<h2 id="org0000000"><a class="headerlink" href="#org0000000">¶</a><span class="section-number-2">1</span> Design principles</h2>
<div class="outline-text-2" id="text-1">
<p>
TODO using 'unix philosophy', or as we call it in software engineering TODO not being a ???
</p>
<p>
Cornerstone of my design is modularity. Most of my tools for data liberation consist of two parts:
</p>
<ul class="org-ul">
<li><p>
export layer TODO example and forward reference
</p>
<p>
The purpose of export script is to reliably fetch and serialize data on your disk.
</p>
<p>
That roughly corresponds to the concept of <a href="sad-infra.html#data_mirror">'data mirror'</a>.
</p>
<p>
Export script deals with dirty business of authorisation, pagination, being tolerant to network errors, etc.
</p></li>
<li><p>
data access layer which I'll refer to as DAL (Data Abstraction/Access Layer) TODO forward reference
</p>
<p>
Purpose of DAL is merely deserialising whatever export script dumped and providing minimalistic data bindings.
</p>
<ul class="org-ul">
<li><p>
TODO normalisation? E.g. new field was added, basically schema change. That means old data needs to be adapted 
</p>
<p>
Example: your banking app used to only support single account, so it was kind of reasonable to keep data as a `List[Transaction]`.
</p>
<p>
Now that they added support for multiple accounts, you have to represent data as `Dict[Account, List[Transaction]]`.
</p>
<p>
Than would mean adapting old data to the new format, e.g. you could extract account id from one of transactions and use it a dictionary key.
</p></li>
</ul>
<p>
TODO link to export?
</p>
<p>
TODO examples
</p>
<ul class="org-ul">
<li><p>
DAL for facebook messenger knows how to read the sqlite database and return iterators over messages.
</p>
<p>
Apart from it, i
</p></li>
</ul></li>
</ul>
<p>
TODO optional part?    
</p>
<ul class="org-ul">
<li>downstream consumers and data providers</li>
</ul>
<p>
It's clearly reasonable to keep export part and DAL close as you don't want them to go out of sync and that's what I'm doing.    
</p>
</div>
<div class="outline-3" id="outline-container-org0000001">
<h3 id="org0000001"><a class="headerlink" href="#org0000001">¶</a><span class="todo TODO">TODO</span> could experiment with some diagram?? E.g. GDPR export for github events + periodic exports?</h3>
<div class="outline-text-3" id="text-org0000001">
</div>
<div class="outline-4" id="outline-container-org0000038">
<h4 id="org0000038"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 23:23]</span></span> would be cool to e.g. double arrow 'interactions', with orger todos things, and demonstrate flow of data</h4>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000002">
<h2 id="org0000002"><a class="headerlink" href="#org0000002">¶</a><span class="section-number-2">2</span> Retrieving data</h2>
<div class="outline-text-2" id="text-2">
<p>
First step in data liberation is to figure out how are you actually supposed to fetch your data?
</p>
<p>
This addreses the authorisation problem. TODO?
TODO maybe just mention the problems we're solving in the intro?
</p>
<p>
TODO Ordered from best to worst.
</p>
<p>
I'll mostly refer to Python libraries since that's what I'm familiar with, but I'm quite sure there are analogues in other languages.
</p>
<p>
Also remember, this is just to fetch data! You can serialize your export as any common format, and use any other programming language you like to acess it.
That's the beauty of decoupling.
</p>
</div>
<div class="outline-3" id="outline-container-org0000003">
<h3 id="org0000003"><a class="headerlink" href="#org0000003">¶</a>public API</h3>
<div class="outline-text-3" id="text-org0000003">
<p>
You register your app, authorise it, get a token, and you free to call various endpoints and fetch whatever you want.   
</p>
<p>
I won't really elaborate on it TODO, if you're reading this you probably have some idea how to use it.
Otherwise, I'm sure there are tutorials out there that would help you.
</p>
<p>
(if anyone knows decent ones, please let me know, I'll add links!)
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000004">
<h3 id="org0000004"><a class="headerlink" href="#org0000004">¶</a>private API</h3>
<div class="outline-text-3" id="text-org0000004">
<p>
Sometimes service doesn't offer an API. 
But it's still very reasonable to use one when you've got backend and frontend that needs to communicate with it.
</p>
<p>
So chances are, the service just isn't exposing it, but you can spy on the token/cookies in your browser devtools and use them to access the API.
</p>
<p>
<a href="https://willschenk.com/articles/2019/reverse_engineering_apis_using_chrome/">https://willschenk.com/articles/2019/reverse_engineering_apis_using_chrome/</a> Reverse engineering APIs using Chrome Developer Tools – 
awesome comprehensive tutorial on why, how and TODO resource for beginners
</p>
<p>
<a href="https://blog.tendigi.com/starbucks-should-really-make-their-apis-public-6b64a1c2e923">https://blog.tendigi.com/starbucks-should-really-make-their-apis-public-6b64a1c2e923</a> huh, awesome, even some encryption…
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000005">
<h3 id="org0000005"><a class="headerlink" href="#org0000005">¶</a>scraping</h3>
<div class="outline-text-3" id="text-org0000005">
<p>
Sometimes service doesn't even use API, e.g. query HTML pages directly.
Difficulties: DDOS protection, e.g. cloudflare.
TODO keep browser profile or something?
</p>
<p>
<a href="https://news.ycombinator.com/item?id=15694118">https://news.ycombinator.com/item?id=15694118</a> Ask HN: What are best tools for web scraping?
</p>
<p>
Self-contained minimum example script to run scrapy
<a href="https://gist.github.com/alecxe/fc1527d6d9492b59c610">https://gist.github.com/alecxe/fc1527d6d9492b59c610</a>
</p>
<p>
<a href="http://sangaline.com/post/advanced-web-scraping-tutorial">http://sangaline.com/post/advanced-web-scraping-tutorial</a>: Advanced Web Scraping: Bypassing "403 Forbidden", captchas, and more
</p>
<p>
In terms of auth, scraping will typically require entering your password.
TODO 2FA
TODO keep separate browser profile in selenium
</p>
</div>
<div class="outline-4" id="outline-container-org0000039">
<h4 id="org0000039"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-09-30 21:31]</span></span> scraping; give amazon as example?</h4>
</div>
</div>
<div class="outline-3" id="outline-container-org0000006">
<h3 id="org0000006"><a class="headerlink" href="#org0000006">¶</a>manual export (GDPR/takeout)</h3>
<div class="outline-text-3" id="text-org0000006">
<p>
On one hand it great they exist, and it is the easiest way to get your data if you don't want to mess with scripts.   
</p>
<p>
That doesn't help in the log run:
</p>
<ul class="org-ul">
<li>you can only do it now and then</li>
<li>it's manual (typically requires requesting and clicking on email link)</li>
<li>it's slow (takes few days)</li>
<li>it's in different format than API data (TODO also motivation for normalising) (TODO mypkg job?)</li>
</ul>
<p>
That said, with certain effort it can be automated too.   
</p>
<p>
TODO initial data?
</p>
</div>
<div class="outline-4" id="outline-container-org000003a">
<h4 id="org000003a"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> github can be requested an export? After that just use scripts   <span class="tag"><span class="backup">backup</span> <span class="blog">blog</span></span></h4>
<div class="outline-text-4" id="text-org000003a">
<p>
exports are asynchronous and not incremental
that's understandable from the backend implementation perspective
</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org0000007">
<h3 id="org0000007"><a class="headerlink" href="#org0000007">¶</a><span class="todo TODO">TODO</span> phones and devices?</h3>
<div class="outline-text-3" id="text-org0000007">
<p>
udev, regular cron script?
ssh?
rooting phone? how to run scripts regularly?
</p>
</div>
<div class="outline-4" id="outline-container-org000003b">
<h4 id="org000003b"><span class="todo TODO">TODO</span> </h4>
<div class="outline-text-4" id="text-org000003b">
<p>
handling phone/devices etc
It's more of a bag of tricks and patterns
I'd be very glad to find out if some of these things are solved in a more generic way, so please throw in your ideas.
</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000008">
<h2 id="org0000008"><a class="headerlink" href="#org0000008">¶</a><span class="section-number-2">3</span> Types of exports</h2>
<div class="outline-text-2" id="text-3">
<p>
First, it would be easier if we establish a bit of vocabulary here.
Since data exports by thir nature are somewhat similar to <a href="https://en.wikipedia.org/wiki/Backup#Backup_methods">backups</a>, I'm borrowing some terminology.
</p>
<p>
The way I see it, there are thre styles of data exports:
</p>
</div>
<div class="outline-3" id="outline-container-org0000009">
<h3 id="org0000009"><a class="headerlink" href="#org0000009">¶</a>full export</h3>
<div class="outline-text-3" id="text-org0000009">
<p>
Basically, every time you run export, go exhaustively through all the endpoints, and fetch the data.
As a result you get some sort of JSON file, which you can keep in a plaintext file.
</p>
<p>
With full export, typically it's okay to overwrite the older export once you fetched everything. 
However I wouldn't recommend it (TODO backups and also atomic stuff?)
</p>
<ul class="org-ul">
<li>advantages
<ul class="org-ul">
<li>straightforward to implement</li>
</ul></li>
<li>disadvantages
<ul class="org-ul">
<li><b>might be impossible</b> due to API restrictions</li>
<li>takes more resources, i.e. time/bandwith/cpu/memory</li>
<li>takes more space if you're keeping old versions</li>
<li>might be flaky due to too many network requests</li>
</ul></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org000000a">
<h3 id="org000000a"><a class="headerlink" href="#org000000a">¶</a>incremental export</h3>
<div class="outline-text-3" id="text-org000000a">
<p>
Incremental means that export kicks off latest state and only fetches missing data.
Typically that means that you need some extra logic to determine the point (e.g. timestamp/message id) to continue from, which introduces opportunity for errors and inconsistencies. 
If you're not careful or misenterpret documentaion you might never request some data. If you're not careful (TODO atomic), you might leave your export in an inconsistent state.
</p>
<p>
Incremental exports are <b>always</b> harder to program. Indeed, full backup is just an edge case of incemental backup when you had no prior data.
</p>
<p>
Why would you bother with exporting data incrementally?
</p>
<ul class="org-ul">
<li><p>
too much data
</p>
<p>
This doesn't even mean too much in terms of bandwith/storage, more of 'too many entities'.
</p>
<p>
E.g. imagine you want fetch to 10000 tweets, that's about 1Mb of raw text data.
Even if you account for extra garbage and assume 10 Mb or even 100 Mb of data, it's basically nothing if you're running it once a day.
</p>
<p>
However, APIs usually impose pagination, so to get these 10000 tweets you might have to do <code class="inline">10000 / 200 = 50</code> API calls. 
Suddenly the whole thing feels much less reliable, so you might want to make it incremental in order to minimize number of network calls.
</p>
<p>
Examples:
</p>
<ul class="org-ul">
<li>Telegram/Messenger/Whatsapp – basically IM always means you're dealing with lots of data</li>
<li>emfit sleep data (API is a bit flaky)</li>
</ul></li>
<li><p>
data is too slow to retrieve
</p>
<p>
For instance, web scraping is always somewhat slower; in addition you might have to rate limit yourself so you don't get banned by DDOS prevention.
</p>
<p>
Also web scraping is even flakier than using APIs, so you want to avoid it if possible
</p></li>
</ul>
<p>
XXX TODO
</p>
<ul class="org-ul">
<li>advantages
<ul class="org-ul">
<li>takes less resources</li>
<li>more resilient (if done right) as needs less network operations</li>
</ul></li>
<li>disadvantages
<ul class="org-ul">
<li>potentially very error prone, harder to implement</li>
</ul></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org000000b">
<h3 id="org000000b"><a class="headerlink" href="#org000000b">¶</a>synthetic export</h3>
<div class="outline-text-3" id="text-org000000b">
<p>
This is kind of a blend between the full export and incremental export.   
</p>
<p>
It's similar to full export in the sense that there isn't that much data to retrieve and if you could, you would just fetch it in one go.
</p>
<p>
However the difference that makes it similar to incremental exports is that you don't have all data available at once, only some latest slice (TODO).
The fundamental issue with synthetic exports is that no single export file will give you all of the data.
</p>
<p>
The reasons for that vary:
</p>
<ul class="org-ul">
<li><p>
API restrictions
</p>
<p>
Example: <a href="https://github.com/karlicoss/rexport#limitations">Reddit</a> limits your API queries to 1000 entries.
</p>
<p>
Presumably, has some infrastructural TODO roots?
</p></li>
<li><p>
Limited memory
</p>
<p>
Example: autonomous devices like HR monitors or temperature monitors are embedded systems with limited memory.
</p>
<p>
Typically, they use some kind of <a href="https://en.wikipedia.org/wiki/Circular_buffer">ring buffer</a> so when you export data, you only get, say, latest 10000 measurements.
</p></li>
<li><p>
Disagreement on the 'state' of the system
</p>
<p>
Example: Kobo reader uses <a href="https://github.com/karlicoss/kobuddy">sqlite database</a> for keeping metadata like highlights, which is awesome!
However, when you delete the book from your reader, it removes your annotations and highlights from the database too.
</p>
<p>
There is absolutely no reason to do this: I delete the book because I don't need it on my reader, not because I want to get rid of annotations.
So in order to have all of them my only option is having regular database snapshots and assembling the full database from these pieces.
</p></li>
<li><p>
Security
</p>
<p>
Example: <a href="https://docs.monzo.com/#list-transactions">Monzo bank API</a>. 
</p>
<blockquote>
<p>
After a user has authenticated, your client can fetch all of their transactions, and after 5 minutes, it can only sync the last 90 days of transactions. If you need the user’s entire transaction history, you should consider fetching and storing it right after authentication. 
</p>
</blockquote>
<p>
So that means that unless you're happy with manually authorizing every time you export, you will only have access to the last 90 days of transactions.
</p>
<p>
Note: I feel kind of sorry complaining at Monzo, considering they are the nicest guys out there in terms of being dev friendly.
But that's the only example of such behavior I've seen so far.
</p></li>
</ul>
<p>
One important difference from other types of exports is that you <b>have to</b> do them regularly/often enough.
Otherwise, you inevitably miss some data and in best case, go through pain of retrieving it TODO alternative ways, or worst case, lose it forever.
</p>
<p>
Now, you could deal with these same way you would with incremental exports, by pulling missing data only.
However, if you do make a mistake in your merging logic (TODO mention merging above), it's not just a matter of waiting to redownload everything. 
Some of the data might be gone <b>forever</b>.
</p>
<p>
TODO that can be TODO via backups?
</p>
<p>
So I take a hybrid approach instead:
</p>
<ul class="org-ul">
<li><p>
at export time, we retrieve whatever data we can and keep it along with a timestamp, like full export.
</p>
<p>
Basically, it makes it 'append-only system', so there is no opportunity for losing data.
</p></li>
<li><p>
at data access time, we dynamically synthesise full export by going through all slices and reconstructing full state, similarly to incremental export
</p>
<p>
That's where 'synthetic' comes from.
</p>
<p>
The full export only exists at runtime, and errors in merging logic are not problematic as you never overwrite data.
</p></li>
</ul>
<ul class="org-ul">
<li>advantages
<ul class="org-ul">
<li>much easier way to achieve incremental exports without having to worry about introducing inconsistencies</li>
<li>very resilient, against pretty much everything: deleted content, data corruption, flaky APIs, programming errors</li>
<li>straightforward to normalise and unify – you are not overwriting anything</li>
</ul></li>
<li>disadvantages
<ul class="org-ul">
<li><p>
takes extra space
</p>
<p>
That said, storage shouldn't be that much of a concert unless you export <b>very</b> often.
With time, storage available grows exponentially and get cheaper, whereas amount of data you generate grows linearly, hence regular exports take 'quadratic' space.
</p>
<p>
If this is an issue, it can also be adressed with compression or even using deduplicating backup software like <a href="https://borgbackup.readthedocs.io/en/stable">borg</a> for storage. However, that would come at the cost of slowing down access.
</p></li>
<li><p>
takes more time to merge snapshots and process
</p>
<p>
Again, it only results in linear slowdown with time and pretty instantaneous for most data sources I have.
</p>
<p>
That can be adressed with TODO using iterators? (so access time is amortized)
</p></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org000000c">
<h2 id="org000000c"><a class="headerlink" href="#org000000c">¶</a><span class="section-number-2">4</span> Export layer</h2>
<div class="outline-text-2" id="text-4">
<p>
TODO not sure if 'exporting layer' would be better?  
</p>
<p>
No matter which way you have to use to export your data, there are some common difficulties, hence patterns.
</p>
<p>
Just a quick reminder of <a href="sad-infra.html#exports_are_hard">the problems</a> that we're dealing with:
</p>
<ul class="org-ul">
<li>authorization: how to get the credentials?</li>
<li>pagination: TODO??</li>
<li>consistency: how to make sure (TODO mention mypy?) you don't 
Even though mypy doesn't support Json type, you can totally type indermediate steps and lists and dictionaries which already helps</li>
<li>rate limits: how to respect server's policy and not get banned?</li>
<li>error handling: how to be defensive enough without uglifying the code?</li>
<li><p>
discovery: what if new endpoints are added
</p>
<p>
TODO I haven't really solved that one, have I? 
</p></li>
</ul>
<p>
Do the <b>absolute minimum</b> work required to get raw data. This is kind of vague, so I will try to explain what I mean by that. TODO elaborate?
</p>
<p>
This section doesn't cover the TODO exact specifics, but it's more of collection of tips of minimizing work necessary:
</p>
</div>
<div class="outline-3" id="outline-container-org000000d">
<h3 id="org000000d"><a class="headerlink" href="#org000000d">¶</a>use existing bindings</h3>
<div class="outline-text-3" id="text-org000000d">
<p>
This may be obvious, but I still feel it has to be said.
Unless retrieving data is trivial (i.e. single GET request), chances that someone already invested effort in dealing with various API quirks.
Bindings often deal with dirty details like API limiting, retrying, pagination etc., so if you're lucky you might end up spending very little effort on exporting data.
</p>
<p>
If there is something in bindings you don't like or lack, it's still easier to monkey patch (if you're using dynamic language) or just fork and patch them up (don't forget to open a pull request later!).
</p>
<p>
Also if you're the author of bindings, I have few requests. Please:
</p>
</div>
<div class="outline-4" id="outline-container-org000003c">
<h4 id="org000003c">Please never print in stdout. It's a pain to filter out and suppress</h4>
</div>
<div class="outline-4" id="outline-container-org000003d">
<h4 id="org000003d"><span class="todo TODO">TODO</span> Please add debug logging. It's pretty sad to</h4>
<div class="outline-text-4" id="text-org000003d">
<p>
TODO write about requests logging?
</p>
</div>
</div>
<div class="outline-4" id="outline-container-org000003e">
<h4 id="org000003e">Please don't be overly defensive, or allow for non-defensive behavior.</h4>
<div class="outline-text-4" id="text-org000003e">
<p>
It's quite sad when library silently catches all exception and replaces with empty strings/nulls/etc without you knowing it.
</p>
</div>
</div>
<div class="outline-4" id="outline-container-org000003f">
<h4 id="org000003f">Please expose raw underlying data (typically, json)</h4>
<div class="outline-text-4" id="text-org000003f">
<p>
If you forget to handle something or the user disagrees how to interpret data they can hack it with accessing raw underlying TODO chunk??
</p>
<p>
  Example of good data object:
<a href="https://github.com/pawelad/pymonzo/blob/b5c8d4f46dcb3a2f475797a8b8ef1c15f6493fb9/src/pymonzo/api_objects.py#L38">https://github.com/pawelad/pymonzo/blob/b5c8d4f46dcb3a2f475797a8b8ef1c15f6493fb9/src/pymonzo/api_objects.py#L38</a>
<a href="https://github.com/pawelad/pymonzo/blob/b5c8d4f46dcb3a2f475797a8b8ef1c15f6493fb9/src/pymonzo/monzo_api.py#L189">https://github.com/pawelad/pymonzo/blob/b5c8d4f46dcb3a2f475797a8b8ef1c15f6493fb9/src/pymonzo/monzo_api.py#L189</a>
</p>
</div>
</div>
<div class="outline-4" id="outline-container-org0000040">
<h4 id="org0000040">Please expose generic methods for handling API calls to make it easy to add new endpoints</h4>
</div>
<div class="outline-4" id="outline-container-org0000041">
<h4 id="org0000041"><span class="todo TODO">TODO</span> examples of emplopying these principles</h4>
<div class="outline-text-4" id="text-org0000041">
<p>
To export <a href="https://github.com/karlicoss/hypexport">Hypothes.is</a> data I'm using existing <a href="https://github.com/judell/Hypothesis">python bindings</a>.
</p>
<ul class="org-ul">
<li>bindings handle <a href="https://github.com/judell/Hypothesis/blob/91f881693546aaddc4096327a97f5cf342c3770a/hypothesis.py#L69">pagination and rate limits</a> for you</li>
<li>even though bindings expose <a href="https://github.com/judell/Hypothesis/blob/master/hypothesis.py#L191"><code class="inline">HypothesisAnnotation</code></a> helper, but default they return raw json, making it trivial to serialize data TODO rephrase/reorder?</li>
<li>bindings expose generic <a href="https://github.com/judell/Hypothesis/blob/91f881693546aaddc4096327a97f5cf342c3770a/hypothesis.py#L138"><code class="inline">authenticated_api_query</code></a> method
For instance, profile data request was missing from the bindings; and it was <a href="https://github.com/karlicoss/hypexport/blob/7a80b36aa55da8b541e2778141eb84ada384d734/hypexport.py#L14">trivial</a> to get it anyway</li>
</ul>
<p>
Thanks to good bindings, the actual export is pretty much <a href="https://github.com/karlicoss/hypexport/blob/7a80b36aa55da8b541e2778141eb84ada384d734/hypexport.py#L6-L19">trivial</a>.
</p>
<p>
Another example: to export <a href="https://github.com/karlicoss/rexport/blob/master/rexport.py">Reddit data</a>, I'm using <a href="https://github.com/praw-dev/praw">praw</a>, excellent library for accessing Reddit from Python.
</p>
<ul class="org-ul">
<li>praw handles rate limits and pagination</li>
<li>praw supports all endpoints, so exporting data is just a matter of <a href="https://github.com/karlicoss/rexport/blob/d001e2d07d716130106ebe07a021f98d84a5ed93/rexport.py#L73-L84">calling right API methods</a></li>
<li>one shortcoming of praw though is that it wouldn't give you access to raw JSON data for some reason, so we need some <a href="https://github.com/karlicoss/rexport/blob/d001e2d07d716130106ebe07a021f98d84a5ed93/rexport.py#L32-L55">hacky logic</a> to serialize.</li>
</ul>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org000000e">
<h3 id="org000000e"><a class="headerlink" href="#org000000e">¶</a><span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:22]</span></span> allow reading credentials from a file</h3>
<div class="outline-text-3" id="text-org000000e">
<ul class="org-ul">
<li>you don't want them in your shell history or in crontabs</li>
<li><p>
Keeping them in file can potentially allow for finer control access
</p>
<p>
E.g. with Unix permissons you could only allow certain scripts to read secrets.
</p></li>
</ul>
<p>
Note that I'm not a security expert, so would be interested to know if there are better solutions to that
</p>
</div>
<div class="outline-4" id="outline-container-org0000042">
<h4 id="org0000042"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:23]</span></span> even better, python script, e.g. potentially it makes it easier to put auth code close etc</h4>
<div class="outline-text-4" id="text-org0000042">
<p>
TODO also link to post that python is a good format for configs?
</p>
</div>
</div>
<div class="outline-4" id="outline-container-org0000043">
<h4 id="org0000043"><span class="todo TODO">TODO</span> <span class="priority">[C]</span> benefits of having secrets in python file: you can keep auth code close to the secrets   <span class="tag"><span class="blog">blog</span> <span class="python">python</span></span></h4>
<div class="outline-text-4" id="text-org0000043">
<p>
e.g. getting new secrets – rerun the secrets.py file
can leave comments (e.g. unlike json)
</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org000000f">
<h3 id="org000000f"><a class="headerlink" href="#org000000f">¶</a>do not be too defensive</h3>
<div class="outline-text-3" id="text-org000000f">
<p>
<b>Never</b> fallback on some wort of default values TODO
TODO generic requests module hook?? dunno.
TODO not sure how to communicate this point, I mean it's kinda of nice if one is willing to do this. But it's hard too
</p>
<p>
If you're willing to – go for it, but TODO it's hard
</p>
<p>
In my experience, it's fair to assume that if export fails, it's a random serverside glitch and not worth fine tuning, it's easier to start export all over again.
</p>
<p>
TODO I'm handling this in a generic way with wrapper script TODO explained later
</p>
<p>
I'd only recommend doing it if you know for sure that certain error 
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000010">
<h3 id="org0000010"><a class="headerlink" href="#org0000010">¶</a>output to stdout if feasible (e.g. json/csv)</h3>
<div class="outline-text-3" id="text-org0000010">
<p>
Outputting to stdout makes your export script composable with other tools and makes error handling easier.
</p>
<p>
TODO be atomic TODO applicable to incremental export
be familiar with the underlying storage you're using and its guarantees
</p>
<p>
TODO compression
TODO naming files
</p>
<p>
TODO elaborate more?
</p>
<p>
One particular example is atomic file writing.
Imagine you've started your export, opened a file and your program crashed in the middle of writing.
Typically that would mean a corrupted export file, that would cause issues downstream.
</p>
<p>
On many files systems moving files is atomic, which can be used to implement atomic writes. However it's somewhat <a href="https://stackoverflow.com/a/2333979/706389">boilerplaty</a>.
If you want to be portable (e.g. <a href="https://stackoverflow.com/a/167555/706389">support Windows</a>), it's going to be even harder to get right.
You really don't want to remember to copy paste it or reimplement every time.
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000011">
<h3 id="org0000011"><a class="headerlink" href="#org0000011">¶</a><span class="todo TODO">TODO</span> not sure how ot integrate timestamps here? maybe separate export wrapper in a separate file?</h3>
</div>
<div class="outline-3" id="outline-container-org0000012">
<h3 id="org0000012"><a class="headerlink" href="#org0000012">¶</a>backup wrapper</h3>
<div class="outline-text-3" id="text-org0000012">
<p>
My suggestion is: allow a wrapper script to handle this, e.g.:
</p>
<p>
<code class="inline">atomicwrapper --path /exports/spotify/$(date -Iseconds --utc).json -- /soft/export/spotify/export.py</code>
</p>
<p>
Pros:
</p>
<ul class="org-ul">
<li>handles timestamping</li>
<li>handles atomic writing</li>
<li>handles backoffs</li>
<li>handles compression</li>
<li>wrapper script is programming language agnostic, as long as you export script simply outputs to stdout</li>
</ul>
<p>
Cons:
</p>
<ul class="org-ul">
<li>a bit more verbose crontabs</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000013">
<h2 id="org0000013"><a class="headerlink" href="#org0000013">¶</a><span class="section-number-2">5</span> <span class="todo TODO">TODO</span> Running/scheduling exports etc?</h2>
<div class="outline-text-2" id="text-5">
<p>
TODO Infrastructure? 
TODO for incremental synthetic exports, empathise that it will be clear how to use that later (and link straight to DAL section dealing with it)
</p>
<p>
Being able to run data export is one thing. 
</p>
<p>
But then, ideally you want to keep them running and more or less forget about it, only checking them now and then.
</p>
<p>
You want 
</p>
<p>
I'm using fcron to run my jobs TODO <a href="https://wiki.archlinux.org/index.php/cron#Fcron">https://wiki.archlinux.org/index.php/cron#Fcron</a>
</p>
<p>
TODO make sure to mention how to configure local mail on errors?
TODO yeah, kron isn't worth mentioning here…
</p>
</div>
<div class="outline-3" id="outline-container-org0000014">
<h3 id="org0000014"><a class="headerlink" href="#org0000014">¶</a><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 00:59]</span></span> going to overlap with data organization bit?</h3>
</div>
<div class="outline-3" id="outline-container-org0000015">
<h3 id="org0000015"><a class="headerlink" href="#org0000015">¶</a><span class="todo TODO">TODO</span> suggest using fcron?   <span class="tag"><span class="exports">exports</span></span></h3>
<div class="outline-text-3" id="text-org0000015">
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000016">
<h2 id="org0000016"><a class="headerlink" href="#org0000016">¶</a><span class="section-number-2">6</span> Data organization: how to keep it</h2>
<div class="outline-text-2" id="text-6">
<p>
TODO is this appendix?  
</p>
<p>
E.g. what's actually kept on filesystem and how
</p>
<p>
naming: include full datetime, that makes it easy to use with unix tools etc
</p>
</div>
<div class="outline-3" id="outline-container-org0000017">
<h3 id="org0000017"><a class="headerlink" href="#org0000017">¶</a><span class="todo TODO">TODO</span> <span class="priority">[D]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 22:43]</span></span> bleanser kind of fits here?</h3>
<div class="outline-text-3" id="text-org0000017">
<p>
just mention it perhaps but elaborate later…
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000018">
<h3 id="org0000018"><a class="headerlink" href="#org0000018">¶</a><span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:56]</span></span> some exceptions: Google takeout – at the moment I just (TODO sift) them now and then</h3>
<div class="outline-text-3" id="text-org0000018">
<p>
they have overlapping data
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000019">
<h3 id="org0000019"><a class="headerlink" href="#org0000019">¶</a><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:57]</span></span> compression – bwrapper</h3>
</div>
<div class="outline-3" id="outline-container-org000001a">
<h3 id="org000001a"><a class="headerlink" href="#org000001a">¶</a><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-09-30 22:01]</span></span> why not borg?</h3>
<div class="outline-text-3" id="text-org000001a">
</div>
<div class="outline-4" id="outline-container-org0000044">
<h4 id="org0000044"><span class="timestamp-wrapper"><span class="timestamp">[2019-09-30 22:01]</span></span> harder to access programmatically</h4>
<div class="outline-text-4" id="text-org0000044">
<p>
read only if it's mounted
</p>
<p>
I was thinking of using some sort of filesystem that's capable of compressing on the fly, but for me it hasn't been a massive concern so far
</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org000001b">
<h3 id="org000001b"><a class="headerlink" href="#org000001b">¶</a><span class="timestamp-wrapper"><span class="timestamp">[2019-12-28 23:57]</span></span> mention that the only acceptable date/time format is some variation of YYYY MM DD HH MM SS Z</h3>
<div class="outline-text-3" id="text-org000001b">
<p>
Reason is it's automatically sort/max friendly.
feel free to sprinkle it with any separators you like and even add milliseconds if you are really serious, but any other date format, e.g.
</p>
<p>
MM/DD/YY (sorry fellow Americans) or using month names, or not using zero-padded numbers is going to bring you serious grief.
</p>
</div>
<div class="outline-4" id="outline-container-org0000045">
<h4 id="org0000045"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 01:03]</span></span> bwrapper? mention {utcnow}</h4>
</div>
<div class="outline-4" id="outline-container-org0000046">
<h4 id="org0000046"><span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 01:03]</span></span> TODO not sure if appendix, or actually, before dal?</h4>
</div>
</div>
<div class="outline-3" id="outline-container-org000001c">
<h3 id="org000001c"><a class="headerlink" href="#org000001c">¶</a><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-09-29 23:30]</span></span> write about bwrapper?</h3>
<div class="outline-text-3" id="text-org000001c">
<p>
mode with utcnow – convenient for me
making interface dump to stdout makes it easier to pipe and make it atomic and stuff
compression
</p>
</div>
<div class="outline-4" id="outline-container-org0000047">
<h4 id="org0000047"><span class="timestamp-wrapper"><span class="timestamp">[2019-12-28 23:56]</span></span> I guess in 'DAL' mention that bwrapper is useful here too.</h4>
</div>
<div class="outline-4" id="outline-container-org0000048">
<h4 id="org0000048"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-30 01:05]</span></span> huh, def this section belongs closer to 'Running exports' section…</h4>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org000001d">
<h2 id="org000001d"><a class="headerlink" href="#org000001d">¶</a><span class="section-number-2">7</span> Data access layer (DAL)</h2>
<div class="outline-text-2" id="text-7">
</div>
<div class="outline-3" id="outline-container-org000001e">
<h3 id="org000001e"><a class="headerlink" href="#org000001e">¶</a><span class="todo TODO">TODO</span> <span class="priority">[C]</span> would be nice to have main for models?   <span class="tag"><span class="dataliberation">dataliberation</span></span></h3>
<div class="outline-text-3" id="text-org000001e">
</div>
</div>
<div class="outline-3" id="outline-container-org000001f">
<h3 id="org000001f"><a class="headerlink" href="#org000001f">¶</a><span class="todo TODO">TODO</span> <span class="priority">[C]</span> do simple html dashboards for each exporter?   <span class="tag"><span class="dataliberation">dataliberation</span></span></h3>
<div class="outline-text-3" id="text-org000001f">
</div>
</div>
<div class="outline-3" id="outline-container-org0000020">
<h3 id="org0000020"><a class="headerlink" href="#org0000020">¶</a><span class="todo TODO">TODO</span> <span class="priority">[C]</span> take single path as argument? or maybe glob=true?   <span class="tag"><span class="dataliberation">dataliberation</span></span></h3>
<div class="outline-text-3" id="text-org0000020">
</div>
</div>
<div class="outline-3" id="outline-container-org0000021">
<h3 id="org0000021"><a class="headerlink" href="#org0000021">¶</a><span class="todo TODO">TODO</span> it's also an experiment in organizing code. demo etc, immediately visualize stuff with pandas   <span class="tag"><span class="exports">exports</span> <span class="blog">blog</span> <span class="dal">dal</span></span></h3>
<div class="outline-text-3" id="text-org0000021">
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000022">
<h2 id="org0000022"><a class="headerlink" href="#org0000022">¶</a><span class="section-number-2">8</span> Similar projects</h2>
<div class="outline-text-2" id="text-8">
</div>
<div class="outline-3" id="outline-container-org0000023">
<h3 id="org0000023"><a class="headerlink" href="#org0000023">¶</a>perkeep</h3>
<div class="outline-text-3" id="text-org0000023">
<p>
Seems to be object-centric, so I'd imagine I would need to communicate with perkeep server to get my stuff?
<a href="https://perkeep.org/doc/compare#objects-not-files">https://perkeep.org/doc/compare#objects-not-files</a>
</p>
<p>
I didn't manage to find a way to query <a href="https://perkeep.org/cmd/">https://perkeep.org/cmd/</a>
I'm not sure if the idea is there needs to be intermediate middleware with a finer API.
<a href="https://perkeep.org/doc/protocol/">https://perkeep.org/doc/protocol/</a>
</p>
<p>
Apparently it enforces schema? <a href="https://deeunderscore.github.io/blog/keeping-things-in-perkeep.html">https://deeunderscore.github.io/blog/keeping-things-in-perkeep.html</a>
</p>
<p>
<a href="https://perkeep.org/doc/overview">https://perkeep.org/doc/overview</a>
</p>
<p>
<a href="https://perkeep.org/doc/uses">https://perkeep.org/doc/uses</a>
</p>
<p>
Ok, it's a bit unclear what it can be used for?
</p>
<p>
<a href="https://news.ycombinator.com/item?id=17615696">https://news.ycombinator.com/item?id=17615696</a>
</p>
</div>
<div class="outline-4" id="outline-container-org0000052">
<h4 id="org0000052">trying out</h4>
<div class="outline-text-4" id="text-org0000052">
</div>
<ul class="org-ul">
<li><a id="org0000049"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:00]</span></span> pinboard importer failed (json parsing)<br /></li>
<li><a id="org000004a"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:01]</span></span> instapaper – couldn't authorise?<br /></li>
<li><a id="org000004b"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:11]</span></span> twitter – some crap about 'switching to developer account'<br /></li>
<li><a id="org000004c"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:11]</span></span> mastodon – success<br /></li>
<li><a id="org000004d"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:12]</span></span> couldn't search for text in UI<br />
<div class="outline-text-5" id="text-org000004d">
<p>
Invalid SearchQuery: Error parsing search expression "whatever": No support for literals yet at position 0, token: "whatever" See: <a href="https://perkeep.org/doc/search-ui">https://perkeep.org/doc/search-ui</a>
</p>
</div>
</li>
<li><a id="org000004e"></a>couldn't see imported data in the fuse mount<br />
<div class="outline-text-5" id="text-org000004e">
<p>
<a href="https://perkeep.org/cmd/pk-mount">https://perkeep.org/cmd/pk-mount</a>, couldn't figure out what's root-blobref
</p>
</div>
</li>
<li><a id="org000004f"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:33]</span></span> couldn't figure out how to request stuff from my importer either via API or HTTP<br /></li>
<li><a id="org0000050"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:33]</span></span> happy if someone using Perkeep points me at the right direction!<br /></li>
<li><a id="org0000051"></a><span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:55]</span></span> apparently not very TODO developed? <a href="https://github.com/perkeep/perkeep/releases">https://github.com/perkeep/perkeep/releases</a><br /></li>
</ul>
</div>
<div class="outline-4" id="outline-container-org0000053">
<h4 id="org0000053"><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2020-01-01 13:29]</span></span> could extract in a separate file perhaps?</h4>
</div>
</div>
<div class="outline-3" id="outline-container-org0000024">
<h3 id="org0000024"><a class="headerlink" href="#org0000024">¶</a><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2018-09-18 02:13]</span></span> <a href="https://reddit.com/r/selfhosted/comments/9go5if/perkeep_lets_you_permanently_keep_your_stuff_for/e665vi6/">Perkeep lets you permanently keep your stuff, for life.</a> /r/selfhosted   <span class="tag"><span class="pkm">pkm</span></span></h3>
<div class="outline-text-3" id="text-org0000024">
<p>
The landing page is too light on details, imho. I get that there's a 'docs' section but at least put something on the opening page more concrete than "if you're technical, you can probably get it up and running" that lets me know what the software actually does.
</p>
<p>
Also, how is this better or worse than any of the other options that are currently available?
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000025">
<h3 id="org0000025"><a class="headerlink" href="#org0000025">¶</a><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-23 16:21]</span></span> Perkeep: personal storage system for life | Hacker News   <span class="tag"><span class="graspw">graspw</span> <span class="pkm">pkm</span></span></h3>
<div class="outline-text-3" id="text-org0000025">
<p>
<a href="https://news.ycombinator.com/item?id=18008240">https://news.ycombinator.com/item?id=18008240</a>
Selection:
</p>
<p>
setra on Sept 17, 2018 [-]
</p>
<p>
TDLR: This is a content addressed data store similar to IPFS (although this project is older). You can configure one of several backends such as local file storage, S3, SSH, etc. It includes an organization system based on tags, and other meta data. You can construct a fuse filesystem representation based on a query. A web UI exists allowing exploration of existing files, uploading, etc.
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000026">
<h3 id="org0000026"><a class="headerlink" href="#org0000026">¶</a><span class="todo TODO">TODO</span> <span class="priority">[C]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-22 16:19]</span></span> perkeep   <span class="tag"><span class="gr">gr</span></span></h3>
<div class="outline-text-3" id="text-org0000026">
<p>
<a href="https://news.ycombinator.com/item?id=21844105">https://news.ycombinator.com/item?id=21844105</a>
Selection:
gpchelkin 4 hours ago [-]
</p>
<p>
I think that Perkeep <a href="https://perkeep.org">https://perkeep.org</a> is also worth mentioning here. One of their latest tools is the one for exporting Google Photos: <a href="https://github.com/perkeep/gphotos-cdp">https://github.com/perkeep/gphotos-cdp</a>
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000027">
<h3 id="org0000027"><a class="headerlink" href="#org0000027">¶</a><span class="todo TODO">TODO</span> <span class="priority">[A]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-15 21:31]</span></span> Digital Tools I Wish Existed | Hacker News   <span class="tag"><span class="perkeep">perkeep</span></span></h3>
<div class="outline-text-3" id="text-org0000027">
<p>
<a href="https://news.ycombinator.com/item?id=21659876">https://news.ycombinator.com/item?id=21659876</a>
Selection:
Perkeep fits some of these cases
</p>
<p>
UnmitigatedFart 12 days ago [-]
</p>
<p>
Huh. This is fascinating project, this does tick some of the boxes for me. Thanks.
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0000028">
<h3 id="org0000028"><a class="headerlink" href="#org0000028">¶</a><span class="todo TODO">TODO</span> <span class="priority">[B]</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-23 16:19]</span></span> Perkeep – Open-source data modeling, storing, search, sharing and synchronizing | Hacker News   <span class="tag"><span class="graspw">graspw</span> <span class="pkm">pkm</span></span></h3>
<div class="outline-text-3" id="text-org0000028">
<p>
<a href="https://news.ycombinator.com/item?id=15928685">https://news.ycombinator.com/item?id=15928685</a>
Selection:
</p>
<p>
mastax on Dec 15, 2017 [-]
</p>
<p>
Since people are confused about what this is I'll write a summary (from old memory so it's probably 80% correct)
It is a consumer-oriented storage system that is:
</p>
<ul class="org-ul">
<li>Content addressable</li>
<li>Indexed</li>
<li>Tag-oriented (vs. hierarchical)</li>
<li>Permissions, encryption, compression, sharing, etc.</li>
<li>Spans storage across machines and clouds</li>
<li>FUSE mountable</li>
<li>Has CLI and Web interfaces built-in</li>
</ul>
<p>
The intent is to be a personal data dumpster that you can throw all of your files and other data (tweets, etc.) into for search and backup.
</p>
<p>
The website could be better organized to convey this information quickly.
</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0000029">
<h2 id="org0000029"><a class="headerlink" href="#org0000029">¶</a><span class="section-number-2">9</span> Integrate</h2>
<div class="outline-text-2" id="text-9">
</div>
<div class="outline-3" id="outline-container-org000002a">
<h3 id="org000002a"><a class="headerlink" href="#org000002a">¶</a><span class="todo TODO">TODO</span> idempotence</h3>
<div class="outline-text-3" id="text-org000002a">
<p>
export tools should result in output 
</p>
<p>
TODO sqlite databases?
TODO atomic moves?
TODO backup wrapper? sadly haven't found an existing tool. it deals with: compression/timestamping/atomicity/backoffs
TODO maybe cooperate with python via some exit code??
</p>
</div>
</div>
<div class="outline-3" id="outline-container-org000002b">
<h3 id="org000002b"><a class="headerlink" href="#org000002b">¶</a><span class="todo TODO">TODO</span> why it's hard: you can't find dummy/mock data to test on   <span class="tag"><span class="exports">exports</span></span></h3>
<div class="outline-text-3" id="text-org000002b">
</div>
</div>
<div class="outline-3" id="outline-container-org000002c">
<h3 id="org000002c"><a class="headerlink" href="#org000002c">¶</a><span class="todo TODO">TODO</span> example of mad auth: endomondo code (user agent etc)   <span class="tag"><span class="exports">exports</span></span></h3>
<div class="outline-text-3" id="text-org000002c">
</div>
</div>
<div class="outline-3" id="outline-container-org000002d">
<h3 id="org000002d"><a class="headerlink" href="#org000002d">¶</a><span class="todo TODO">TODO</span> in order to preserve sanity, serializing needs to be paired with deserializing, that's the main motivation for DAL   <span class="tag"><span class="exports">exports</span> <span class="blog">blog</span></span></h3>
<div class="outline-text-3" id="text-org000002d">
</div>
</div>
<div class="outline-3" id="outline-container-org000002e">
<h3 id="org000002e"><a class="headerlink" href="#org000002e">¶</a><span class="todo TODO">TODO</span> <span class="timestamp-wrapper"><span class="timestamp">[2019-12-26 23:24]</span></span> potential idea: some sort of community supported sandbox allowing to manage tokens and exposing them in code/files, showing expiry times etc</h3>
</div>
<div class="outline-3" id="outline-container-org000002f">
<h3 id="org000002f"><a class="headerlink" href="#org000002f">¶</a><span class="todo TODO">TODO</span> Incremental backups</h3>
</div>
<div class="outline-3" id="outline-container-org0000030">
<h3 id="org0000030"><a class="headerlink" href="#org0000030">¶</a><span class="todo TODO">TODO</span> have a suggestion for #begin<sub>xxx</sub> thing to take in html tags?</h3>
</div>
</div>
<div class="outline-2" id="outline-container-org0000031">
<h2 id="org0000031"><a class="headerlink" href="#org0000031">¶</a><span class="section-number-2">10</span> <span class="todo TODO">TODO</span> <a href="https://stackoverflow.com/questions/15431044/can-i-set-max-retries-for-requests-request">https://stackoverflow.com/questions/15431044/can-i-set-max-retries-for-requests-request</a>   <span class="tag"><span class="exports">exports</span></span></h2>
<div class="outline-text-2" id="text-10">
<p>
try how retry policy works? e.g. wonder if you can monkey patch it
</p>
</div>
</div>
<div class="outline-2" id="outline-container-org0000032">
<h2 id="org0000032"><a class="headerlink" href="#org0000032">¶</a><span class="section-number-2">11</span> example of synthetic: browser export   <span class="tag"><span class="exports">exports</span></span></h2>
<div class="outline-text-2" id="text-11">
</div>
</div>
<div class="outline-2" id="outline-container-org0000033">
<h2 id="org0000033"><a class="headerlink" href="#org0000033">¶</a><span class="section-number-2">12</span> <span class="todo TODO">TODO</span> CCPA? wonder if it's similar to GDPR   <span class="tag"><span class="exports">exports</span></span></h2>
<div class="outline-text-2" id="text-12">
</div>
</div>
<div class="outline-2" id="outline-container-org0000034">
<h2 id="org0000034"><a class="headerlink" href="#org0000034">¶</a><span class="section-number-2">13</span> <span class="todo TODO">TODO</span> resue existing libraries as far as possible (both for exporting and as a means of DAL), e.g. monzo example</h2>
<div class="outline-text-2" id="text-13">
</div>
</div>
<div class="outline-2" id="outline-container-org0000035">
<h2 id="org0000035"><a class="headerlink" href="#org0000035">¶</a><span class="section-number-2">14</span> <span class="todo TODO">TODO</span> separation of concernts. it's annoying to take care about file names/dates/atomicity in individual scripts</h2>
<div class="outline-text-2" id="text-14">
</div>
</div>
<div class="outline-2" id="outline-container-org0000036">
<h2 id="org0000036"><a class="headerlink" href="#org0000036">¶</a><span class="section-number-2">15</span> <span class="todo TODO">TODO</span> would be nice to update metadata if possible? some fields could be marked as such and allowed to update</h2>
<div class="outline-text-2" id="text-15">
<p>
and yeah, it's very important to have a proper key
</p>
</div>
</div>
<div class="outline-2" id="outline-container-org0000037">
<h2 id="org0000037"><a class="headerlink" href="#org0000037">¶</a><span class="section-number-2">16</span> <span class="todo TODO">TODO</span> Why do I need file output for export helper?   <span class="tag"><span class="exports">exports</span></span></h2>
<div class="outline-text-2" id="text-16">
</div>
</div>

    </section>

    
    <section class="footer">
        <div class="post-tags"><a class="post-tag" href="./tags.html#dataliberation">#dataliberation</a> <a class="post-tag" href="./tags.html#infra">#infra</a> <a class="post-tag" href="./tags.html#pkm">#pkm</a></div>
        <!-- TODO post-date? -->
        <div class="date">29 September 2019</div>
    </section>
    

    

    <section class="comments">
    <script data-isso="https://beepb00p.xyz/comments/" data-isso-reply-to-self="true" src="https://beepb00p.xyz/comments/js/embed.min.js">
</script>

<section id="isso-thread" data-isso-id="isso_exports"></section>

    </section>

</article>

        </main>

        <!-- TODO hmm maybe display something in a footer, so it's clear it's end of content... -->
        
        <footer>
            <span style="float:left">
            <a href="https://twitter.com/karlicoss">🐦 me @twitter</a>
            ·
            <a href="https://github.com/karlicoss">💻 me @github</a>
            </span>
            
            
        </footer>
    </body>
</html>
