<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Icon made by Twitter -->
        <!-- https://twemoji.twitter.com/content/twemoji-twitter/en.html -->
        <link rel="icon" href="./robot-face.png">
        <link rel="apple-touch-icon" href="./robot-face.png">

        <meta name="generator" content="hakyll">
        <meta name="language" content="English">
        
        <meta name="keywords" content="physics ipython">
        
        <!-- TODO concat with keywords tags; also need to make comma separated? -->

        <title>They see me flowin' they hatin' | beepb00p</title>

        <link href="https://fonts.googleapis.com/css?family=Source+Serif+Pro" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="./css/default.css?v=3" />
        <!-- TODO make conditional?? -->
        <link rel="stylesheet" href="./css/posts-list.css" /> 
        <link rel="stylesheet" href="./css/links.css?v=4" />

        
        <script type="text/javascript">
 window.MathJax = {
     tex2jax: {
         // note that hakyll source has got double dollar signs due to special meaning in templates
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         processEscapes: true
     }
 };
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        

        <link rel="canonical" href="https://beepb00p.xyz/lagrangians.html" />

        <!-- can test it with https://telegram.me/webpagebot -->
        <!-- or https://developers.facebook.com/tools/debug -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://beepb00p.xyz/lagrangians.html" /> <!-- TODO base? -->
        <meta property="og:title" content="They see me flowin' they hatin' | beepb00p" />
        <meta property="og:description" content="Some questionable experiments with Lagrangians" />
        <!-- ugh. why is image necessary??? otherwise other parts aren't working or I get lots of 404s -->
        <!-- ugh. Facebook really wants jpg? -->
        <!-- also Facebook displays it with black background, but whatever, fuck it. -->
        <meta property="og:image" content="https://beepb00p.xyz/robot-face.jpg" />

    </head>
    <body>
        <!-- TODO make semantic -->
        <header>
            <nav>
                <span class="nav-left">
                    <a class="fat" href="./">Home</a>
                    <!-- TODO eh, not sure if this symbol is good for that... -->
                    ·
                    <a class="fat" href="./ideas.html">Ideas</a>
                    ·
                    <a class="fat" href="./notes.html">Notes</a>
                    ·
                    <a class="fat" href="./tags.html">Tags</a>
                </span>
                <span class="nav-right">
                    <a class="fat" href="./feed.html">Feed</a>
                    ·
                    <a class="fat" href="./site.html">Site</a>
                    ·
                    <a class="fat" href="./me.html">Me</a>
                </span>
            </nav>
        </header>

        <main>
            
<link rel="stylesheet" href="./css/ipynb.css" />
<link rel="stylesheet" href="./css/ipynb-syntax.css" />




<article>
    
    <div>THIS IS A DRAFT! It will appear on the main page once finished!</div>
    
    <section class="post-title">
    <h1>They see me flowin' they hatin'</h1>
    <div class="summary">Some questionable experiments with Lagrangians</h2>
    </section>
    <!-- are sections appropriate for that? -->

    <section class="content">
    


    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A while ago when I was learning classical mechanics I started wondering what makes a good physical Lagrangian and how does its shape impact the laws of motion. I seem to be more of software engineer than a physycist in spirit so rather than learning classical mechanics, instead I ended up doing various experiments with plotting, rendering, modelling and literate programming. So while I'm not exactly doing any novel physics here, I also haven't seen this visualised anywhere (apart from the simplest case). Hopefully it will help other people in understanding and serve as a demo of Ipython's capabilities.</p>
<p>This post assumes some basic (wikipedia level) understanding of Lagrangian/Hamiltonian mechanics, but you don't have to if you just fancy some plots. For the purposes of this post, Lagrangian is just any function of a particle's position and velocity.</p>

</div>
</div>
</div>





   
   <details class="cell-collapsed">
   <summary>Routines for easier multiline printing <span class="cell-collapsed-expand">(click to expand)</span></summary>
       
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># see https://beepb00p.xyz/ipynb-singleline.html</span>

<span class="k">def</span> <span class="nf">ldisplay_md</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Markdown</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="s1">'${latex(x)}$'</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">),</span>
        <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">f</span><span class="s1">'${latex(v)}$'</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
    <span class="p">))</span>
    
<span class="k">def</span> <span class="nf">as_text</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="k">import</span> <span class="n">InteractiveShell</span> <span class="c1"># type: ignore</span>
    <span class="n">plain_formatter</span> <span class="o">=</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_formatter</span><span class="o">.</span><span class="n">formatters</span><span class="p">[</span><span class="s1">'text/plain'</span><span class="p">]</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">plain_formatter</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lines</span>

<span class="k">def</span> <span class="nf">vcpad</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">above</span> <span class="o">=</span> <span class="n">missing</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">below</span> <span class="o">=</span> <span class="n">missing</span> <span class="o">-</span> <span class="n">above</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">' '</span> <span class="o">*</span> <span class="n">width</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">above</span><span class="p">)]</span> <span class="o">+</span> <span class="n">lines</span> <span class="o">+</span> <span class="p">[</span><span class="s1">' '</span> <span class="o">*</span> <span class="n">width</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">below</span><span class="p">)]</span>

<span class="c1"># terminal and emacs can't display markdown, so we have to use that as a workaround</span>
<span class="k">def</span> <span class="nf">mdisplay_plain</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>
    <span class="n">fargs</span>   <span class="o">=</span> <span class="p">[</span><span class="n">as_text</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
    <span class="n">fkwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">as_text</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">fargs</span><span class="p">,</span> <span class="n">fkwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="n">pargs</span>   <span class="o">=</span> <span class="p">[</span><span class="n">vcpad</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fargs</span><span class="p">]</span>
    <span class="n">pkwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">vcpad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fkwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">textpos</span> <span class="o">=</span> <span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
        <span class="n">largs</span>   <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">]</span>
        <span class="n">lkwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pkwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="n">textpos</span><span class="p">:</span>
            <span class="n">fstr</span> <span class="o">=</span> <span class="n">fmt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we want to keep the formatting specifiers (stuff in curly braces and empty everything else)</span>
            <span class="n">fstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s1">'{.*?}'</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
                <span class="n">fstr</span> <span class="o">=</span> <span class="n">fstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fstr</span><span class="p">))</span>
                <span class="n">fstr</span> <span class="o">+=</span> <span class="n">e</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">largs</span><span class="p">,</span> <span class="o">**</span><span class="n">lkwargs</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>

<span class="n">ldisplay</span> <span class="o">=</span> <span class="n">ldisplay_md</span>
</pre></div>

    </div>
</div>
</div>

</div>
   </details>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">diff</span> <span class="k">as</span> <span class="n">D</span><span class="p">,</span> <span class="n">Function</span> <span class="k">as</span> <span class="n">F</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">'t'</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># time</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">'q'</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># position</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># velocity</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># [conjugate] momentum</span>
</pre></div>

    </div>
</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sadly, jupyter's capabilities for literate programing turned out to be poorer than I expected...
Basically, you can't split a function among several cells. (TODO perhaps hack it via CSS or something?)
So, over the course of the following function I'm gonna communicate with you via comments.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">lagrangian_to_hamiltons_equations</span><span class="p">(</span><span class="n">Lag</span><span class="p">):</span>
    <span class="c1"># So, we've got a Lagrangian:</span>
    <span class="n">ldisplay</span><span class="p">(</span><span class="s2">&quot;$L$ = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Lag</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To actually get the laws of motion it's way more convenient to solve Hamilton's equations.</span>
<span class="sd">    It's fairly easy to get them via something called Legendre transormation:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Hamiltonian_mechanics#Calculating_a_Hamiltonian_from_a_Lagrangian    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">p_of_v</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Lag</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="p">[</span><span class="n">sol</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">p_of_v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">v_of_p</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
    <span class="n">ldisplay</span><span class="p">(</span><span class="s2">&quot;$p$ over $v$: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">p_of_v</span><span class="p">)</span>
    <span class="n">ldisplay</span><span class="p">(</span><span class="s2">&quot;$v$ over $p$: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v_of_p</span><span class="p">)</span>
    
    <span class="c1"># looks like variable replacement in Sympy is a bit more tedious than I expected</span>
    <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">p_of_v</span><span class="o">.</span><span class="n">rhs</span> <span class="o">-</span> <span class="n">Lag</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">v_of_p</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span> <span class="n">v_of_p</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
    <span class="n">ldisplay</span><span class="p">(</span><span class="s2">&quot;$H$ = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span> <span class="c1"># cool, we've got Hamiltonian</span>
    
    <span class="n">dq_eq</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>  <span class="n">H</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="n">dp_eq</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">-</span><span class="n">H</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    
    <span class="n">ldisplay</span><span class="p">(</span><span class="s2">&quot;Hamilton's equations: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">dq_eq</span><span class="p">,</span> <span class="n">dp_eq</span><span class="p">])</span>
    
    <span class="kn">from</span> <span class="nn">sympy.solvers.ode</span> <span class="k">import</span> <span class="n">classify_sysode</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">classify_sysode</span><span class="p">([</span><span class="n">dq_eq</span><span class="p">,</span> <span class="n">dp_eq</span><span class="p">]))</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    lambdify is neat! It substitutes numpy equivalents for sympy functions,</span>
<span class="sd">    so we get decent performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">dq_eq</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">dp_eq</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ok, let's finally have a break from this function, the actual numerical solving</span>
<span class="sd">    can be extracted in a different function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now we need to define some slightly cryptic routines to integrate and plot stuff. Hopefully, later their purpose would become more clear.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="k">class</span> <span class="nc">Lagrangian</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents both symbolic Lagrangian for plotting convenience and</span>
<span class="sd">    also caches computations for Hamilton's equations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag</span> <span class="o">=</span> <span class="n">expr</span>
        
    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dq_dp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lagrangian_to_hamiltons_equations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lag</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>





   
   <details class="cell-collapsed">
   <summary>Routines for integration and plotting <span class="cell-collapsed-expand">(click to expand)</span></summary>
       
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">sympy.plotting</span> <span class="k">import</span> <span class="n">plot</span><span class="p">,</span> <span class="n">plot_parametric</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span> 
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">linspace</span>

<span class="k">def</span> <span class="nf">plot_motion</span><span class="p">(</span>
    <span class="n">lagrangian</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># initial data</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">T_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
    <span class="n">q_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">p_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_lag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_pq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_legends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">dq</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">lagrangian</span><span class="o">.</span><span class="n">dq_dp</span>
    
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q0p0s</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">'{float(qq):.1f}, {float(pp):.1f}'</span> <span class="k">for</span> <span class="p">(</span><span class="n">qq</span><span class="p">,</span> <span class="n">pp</span><span class="p">)</span> <span class="ow">in</span> <span class="n">q0p0s</span><span class="p">]</span>
    
    <span class="n">times</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_max</span><span class="p">,</span> <span class="n">T_steps</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">integrate_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">prev_q</span><span class="p">,</span> <span class="n">prev_p</span> <span class="o">=</span> <span class="n">qp</span>
        <span class="n">next_q</span> <span class="o">=</span> <span class="n">dq</span><span class="p">(</span><span class="n">prev_q</span><span class="p">,</span> <span class="n">prev_p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">next_p</span> <span class="o">=</span>  <span class="n">dp</span><span class="p">(</span><span class="n">prev_q</span><span class="p">,</span> <span class="n">prev_p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">next_q</span><span class="p">,</span> <span class="n">next_p</span><span class="p">)</span>
    
    <span class="n">all_ts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_qs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q0</span><span class="p">,</span> <span class="n">p0</span> <span class="ow">in</span> <span class="n">q0p0s</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">integrate_step</span><span class="p">,</span> <span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">p0</span><span class="p">),</span> <span class="n">times</span><span class="p">)</span>
        <span class="n">all_ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">all_qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">all_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># ok, let's plot everything now!</span>

    <span class="n">blues</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">winter</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">reds</span>   <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">autumn</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">greens</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    
    <span class="c1"># TODO display trajectories on Lagrangian?</span>
    <span class="c1"># TODO also make a note that it's not easy to see how would the trajectory make action stationary</span>
    <span class="k">if</span> <span class="n">plot_lag</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span> <span class="c1"># TODO how to configure it?</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># TODO ?</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">q_max</span><span class="p">,</span> <span class="n">q_max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">p_max</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">lagrangian</span><span class="o">.</span><span class="n">lag</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="n">ax3d</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">'Lagrangian </span><span class="si">{lagrangian.lag}</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'q'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">'L'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
        
    <span class="k">if</span> <span class="n">plot_pq</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'position/momentum over time'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'t'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'q,p'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">red</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">all_ts</span><span class="p">,</span> <span class="n">all_qs</span><span class="p">,</span> <span class="n">all_ps</span><span class="p">,</span> <span class="n">blues</span><span class="p">,</span> <span class="n">reds</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">'q </span><span class="si">{label}</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">'p </span><span class="si">{label}</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_legends</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot_phase</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax3d</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">)</span>
    
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'phase plot'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'q(t)'</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'p(t)'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">q_max</span><span class="p">,</span> <span class="n">q_max</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">p_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="n">p_max</span><span class="p">,</span> <span class="n">p_max</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">green</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">all_ts</span><span class="p">,</span> <span class="n">all_qs</span><span class="p">,</span> <span class="n">all_ps</span><span class="p">,</span> <span class="n">greens</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">green</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s1">'</span><span class="si">{label}</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_legends</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>

        <span class="n">ax3d</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'phase plot'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'q'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">'t'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax3d</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">q_max</span><span class="p">,</span> <span class="n">q_max</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">p_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax3d</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="n">p_max</span><span class="p">,</span> <span class="n">p_max</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">green</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">all_ts</span><span class="p">,</span> <span class="n">all_qs</span><span class="p">,</span> <span class="n">all_ps</span><span class="p">,</span> <span class="n">greens</span><span class="p">):</span>
            <span class="n">ax3d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">green</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_legends</span><span class="p">:</span> <span class="n">ax3d</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
   </details>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now that we defined the boilerplate, let's actually do something.</p>
<p>First test subject is pretty obvious: <a href="https://en.wikipedia.org/wiki/Harmonic_oscillator#Simple_harmonic_oscillator">the harmonic oscillator</a>.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">half</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
<span class="n">L_harm</span> <span class="o">=</span> <span class="n">Lagrangian</span><span class="p">(</span><span class="n">half</span> <span class="o">*</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">half</span> <span class="o">*</span> <span class="n">q</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L_harm</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span> <span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span> <span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">q_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$L$ = $- \frac{q^{2}{\left(t \right)}}{2} + \frac{v^{2}{\left(t \right)}}{2}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$p$ over $v$: $p{\left(t \right)} = v{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$v$ over $p$: $v{\left(t \right)} = p{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$H$ = $\frac{p^{2}{\left(t \right)}}{2} + \frac{q^{2}{\left(t \right)}}{2}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>Hamilton's equations: $\left[ \frac{d}{d t} q{\left(t \right)} = p{\left(t \right)}, \  \frac{d}{d t} p{\left(t \right)} = - q{\left(t \right)}\right]$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{'no_of_equation': 2, 'eq': [-p(t) + Derivative(q(t), t), q(t) + Derivative(p(t), t)], 'func': [q(t), p(t)], 'order': {p(t): 1, q(t): 1}, 'func_coeff': {(0, q(t), 0): 0, (0, q(t), 1): 1, (0, p(t), 0): -1, (0, p(t), 1): 0, (1, q(t), 0): 1, (1, q(t), 1): 0, (1, p(t), 0): 0, (1, p(t), 1): 1}, 'is_linear': True, 'type_of_equation': 'type1'}
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_9_6.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_9_7.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_9_8.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As expected, we get circular motion in the position-momentum plane and a nice spiral on the projective plot.</p>
<p>Let's try something else!</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L_hill</span> <span class="o">=</span> <span class="n">Lagrangian</span><span class="p">(</span><span class="n">half</span> <span class="o">*</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">half</span> <span class="o">*</span> <span class="n">q</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L_hill</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">q_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$L$ = $\frac{q^{2}{\left(t \right)}}{2} + \frac{v^{2}{\left(t \right)}}{2}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$p$ over $v$: $p{\left(t \right)} = v{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$v$ over $p$: $v{\left(t \right)} = p{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$H$ = $\frac{p^{2}{\left(t \right)}}{2} - \frac{q^{2}{\left(t \right)}}{2}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>Hamilton's equations: $\left[ \frac{d}{d t} q{\left(t \right)} = p{\left(t \right)}, \  \frac{d}{d t} p{\left(t \right)} = q{\left(t \right)}\right]$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{'no_of_equation': 2, 'eq': [-p(t) + Derivative(q(t), t), -q(t) + Derivative(p(t), t)], 'func': [q(t), p(t)], 'order': {p(t): 1, q(t): 1}, 'func_coeff': {(0, q(t), 0): 0, (0, q(t), 1): 1, (0, p(t), 0): -1, (0, p(t), 1): 0, (1, q(t), 0): -1, (1, q(t), 1): 0, (1, p(t), 0): 0, (1, p(t), 1): 1}, 'is_linear': True, 'type_of_equation': 'type1'}
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_11_6.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_11_7.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_11_8.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you think about it, here we've got a potential hill! So the only equilibrium for this system is $q=0, p=0$. (TODO principle of least action?) Within this Lagrangian, you can reach it if your momentum (which coincides with velocity) is larger than the position in absolute value and of the opposite sign.</p>
<p>If the sign you your momentum is same as the sign of your position, you're basically forever doomed to slide down the potential! We can illustrate that by plotting more phase plots:</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">phis</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">R</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">R</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">phis</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">circlespace</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">circle</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">points</span><span class="p">))</span>

<span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L_hill</span><span class="p">,</span>
    <span class="n">q0p0s</span><span class="o">=</span><span class="n">circlespace</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">36</span><span class="p">),</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">plot_lag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_legends</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_13_0.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you look at the 2D phase plot, you can clearly spot hyperbolas. This is not a coincidence considering that the Hamiltonian can be interpreted as energy which is conserved during the motion, and the lines where $p^2 + q^2 = \text{const}$ are precisely hyperbolas!</p>
<p>Actually, matplotlib allows us to plot something even nicer:  <code>quiver</code> (usually called vector field or slope field) and <code>streamplot</code>.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_ham_field</span><span class="p">(</span>
    <span class="n">lagrangian</span><span class="p">,</span> 
    <span class="n">steps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> 
    <span class="n">qlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">plim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">dq</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">lagrangian</span><span class="o">.</span><span class="n">dq_dp</span>
    
    <span class="n">qs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">qlim</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">plim</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">Q</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
    
    <span class="n">T</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># we're exploiting knowledge that hamiltonians are time independent in our case</span>
    <span class="n">Hq</span> <span class="o">=</span> <span class="n">dq</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">Hp</span> <span class="o">=</span> <span class="n">dp</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Hamiltonian vector field&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'q'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">Hq</span><span class="p">,</span> <span class="n">Hp</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">Hq</span><span class="p">,</span> <span class="n">Hp</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_ham_field</span><span class="p">(</span><span class="n">L_hill</span><span class="p">,</span> <span class="n">qlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">plim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_16_0.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this form it's easier to interpret this vector field physically: if you put a particle somewhere, it would follow the arrows. In this case as you can see, particles shoot off at infinity no matter what, which makes it evident why is that Lagrangian unpphysical (although doesn't explain what is it in the shape of Lagrangian that makes it so).</p>
<p>Grant Sanderson (3Blue1Brown) has a nice <a href="https://youtu.be/p_di4Zn4wz4?t=1217">video</a> featuring some animated vector field flows.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now let's try something truly weird.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">Lagrangian</span><span class="p">(</span><span class="n">half</span> <span class="o">*</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># TODO L = half * v ** 2 * q</span>
<span class="c1"># TODO hmmm. I used to have q^2. Can it be problematic for legendre transform?? Seems ok in terms of having inverse though</span>
<span class="c1"># TODO investigate it separately?? </span>
<span class="c1"># TODO analytical solution https://www.wolframalpha.com/input/?i=q%27%3Dp%2Fq;+p%27%3Dp%5E2%2F+(2+*+q%5E2)</span>
<span class="c1"># doesn't seem to behave well for negative time. something has to be wrong, right?)</span>

<span class="c1"># TODO ok, if we set T_max to 0.5, we get warnings that are impossible to get rid of..</span>
<span class="c1"># presumably from sysode?</span>
<span class="c1"># from IPython.utils import io</span>
<span class="c1"># with io.capture_output(display=False) as captured: -- doesn't work :(</span>
<span class="c1"># https://stackoverflow.com/a/22434262/706389 -- doesn't work either, ipython intercepts fd 0?</span>

<span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">q_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mf">0.48</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$L$ = $\frac{q^{2}{\left(t \right)} v^{2}{\left(t \right)}}{2}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$p$ over $v$: $p{\left(t \right)} = q^{2}{\left(t \right)} v{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$v$ over $p$: $v{\left(t \right)} = \frac{p{\left(t \right)}}{q^{2}{\left(t \right)}}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$H$ = $\frac{p^{2}{\left(t \right)}}{2 q^{2}{\left(t \right)}}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>Hamilton's equations: $\left[ \frac{d}{d t} q{\left(t \right)} = \frac{p{\left(t \right)}}{q^{2}{\left(t \right)}}, \  \frac{d}{d t} p{\left(t \right)} = \frac{p^{2}{\left(t \right)}}{q^{3}{\left(t \right)}}\right]$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{'no_of_equation': 2, 'eq': [-p(t)/q(t)**2 + Derivative(q(t), t), -p(t)**2/q(t)**3 + Derivative(p(t), t)], 'func': [q(t), p(t)], 'order': {p(t): 1, q(t): 1}, 'func_coeff': {(0, q(t), 0): 0, (0, q(t), 1): 1, (0, p(t), 0): -1/q(t)**2, (0, p(t), 1): 0, (1, q(t), 0): 0, (1, q(t), 1): 0, (1, p(t), 0): 0, (1, p(t), 1): 1}, 'is_linear': False, 'type_of_equation': 'type3'}
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_19_6.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_19_7.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_19_8.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now this is something fun! We get some warning from the ODE solver. I've cheated a bit and chosen <code>T_max</code> carefully here, if you increase it past 0.5, the numerical solution just goes nuts. And fair enough, if you look at the Hamiltonian, when $q=0$ clearly something bad has to happen. Sadly, Sympy got a <a href="https://github.com/sympy/sympy/issues/15707">bug</a> in the solver for that type of equations, so let's try doing it the old, manual way.</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Starting with $\left [ \frac{d}{d t} q{\left (t \right )} = \frac{p{\left (t \right )}}{q^{2}{\left (t \right )}}, \quad \frac{d}{d t} p{\left (t \right )} = \frac{p^{2}{\left (t \right )}}{q^{3}{\left (t \right )}}\right ]$, if we divide LH and RH sides, we get something nice: (TODO ugh, not sure if we can do that formally... perhaps express second equation over p(t) from first...)</p>
$$\frac{q'(t)}{p'(t)} = \frac{q(t)}{p(t)}$$$$\frac{q'(t)}{q(t)} = \frac{p'(t)}{p(t)}$$<p>If we integrate both parts, we get
$$\ln q(t) = \ln p(t) + C$$
or, equivalently,
$$q(t) = C p(t)$$</p>
<p>I find it interesting that we kind of could have seen it coming from the Hamiltonian if we think about what does it take for it to be a constant along the trajectory. Not sure if this argument can be generally useful though. But the important bit is that in our case, we have $H = \frac{1}{2 C^2}$, so surely there can't be problem when $q = 0$. Let's dig further. If we substitute or result for $q$ in its Hamiltonian equation, we get:</p>
$$C p'(t) = \frac{p(t)}{C^2 p^2(t)}$$$$ p'(t) = \frac{1}{C^2} \frac{1}{p(t)}$$$$p^2(t) = \frac{1}{C^2} t^2 + D$$
</div>
</div>
</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO ugh. fucking hell, I'm stuck. Say we fixed p(0) = 1, q(0) = -1. Then, C = -1; D = 1 and p^2 = t^2 + 1. That means that p(t) is a parabola with minimum at t = 0 right? However judging by the vector field it would end up at 0 at some point. what am I missing??? have I lost the coupling somehow? pretty sure that isn't solvable explicitly and I just made a mistake somewhere..
TODO hmm. Unless it takes infinite time to get from t = 0?? probably bullshit though...</p>
<p>fucking hell, I'm so tired of this. also somthing in 'simpler equation.ipynb'
q'=p/q; p'=q/p 
<a href="http://www.maths.surrey.ac.uk/explore/vithyaspages/coupled.html">http://www.maths.surrey.ac.uk/explore/vithyaspages/coupled.html</a></p>
<p>First thing that I find interesting is that this clearly discriminates against negative $t$. TODO is that interesting actually?</p>
<p>Second, is that it's easy to see that when</p>
<p>TODO ugh, must have something to do with branch cuts...</p>
<p>TODO shit. maybe just give up on this one and write something about non-regularity (as in, lagrangian is non-regular over the whole q = 0 line)</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's hard to tell what this Lagrangian represents TODO let me know.
TODO highligh todos in hakyll/ci?
TODO wtf?? slope field in wolfram is complete
<a href="https://www.wolframalpha.com/input/?i=q%27%3Dp%2Fq%5E2;+p%27%3Dp%5E2%2Fq%5E3">https://www.wolframalpha.com/input/?i=q%27%3Dp%2Fq%5E2;+p%27%3Dp%5E2%2Fq%5E3</a>
TODO mm. does it depend on which solution you choose or what?
TODO huh? wolfram is solving it in complex numbers... <a href="https://www.wolframalpha.com/input/?i=q%27%3Dp%2Fq%5E2;+p%27%3Dp%5E2%2Fq%5E3+,+q(0)%3D-5,+p(0)%3D5">https://www.wolframalpha.com/input/?i=q%27%3Dp%2Fq%5E2;+p%27%3Dp%5E2%2Fq%5E3+,+q(0)%3D-5,+p(0)%3D5</a></p>
<p>TODO investigate what happens around 0...</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_ham_field</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">qlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_24_0.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try something else</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">Lagrangian</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">q_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$L$ = $- q^{2}{\left(t \right)} + e^{v{\left(t \right)}}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$p$ over $v$: $p{\left(t \right)} = e^{v{\left(t \right)}}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$v$ over $p$: $v{\left(t \right)} = \log{\left(p{\left(t \right)} \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>$H$ = $p{\left(t \right)} \log{\left(p{\left(t \right)} \right)} - p{\left(t \right)} + q^{2}{\left(t \right)}$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_markdown rendered_html output_subarea ">
<p>Hamilton's equations: $\left[ \frac{d}{d t} q{\left(t \right)} = \log{\left(p{\left(t \right)} \right)}, \  \frac{d}{d t} p{\left(t \right)} = - 2 q{\left(t \right)}\right]$</p>

</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{'no_of_equation': 2, 'eq': [-log(p(t)) + Derivative(q(t), t), 2*q(t) + Derivative(p(t), t)], 'func': [q(t), p(t)], 'order': {p(t): 1, q(t): 1}, 'func_coeff': {(0, q(t), 0): 0, (0, q(t), 1): 1, (0, p(t), 0): 0, (0, p(t), 1): 0, (1, q(t), 0): 2, (1, q(t), 1): 0, (1, p(t), 0): 0, (1, p(t), 1): 1}, 'is_linear': False, 'type_of_equation': 'type3'}
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/karlicos/.local/lib/python3.7/site-packages/scipy/integrate/odepack.py:244: ComplexWarning: Casting complex values to real discards the imaginary part
  int(bool(tfirst)))
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_26_7.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_26_8.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Uh-oh, momentum appears under logarigthm. Let's just exclude negative momentum for now..</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[(</span><span class="n">q0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">q0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">q0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">p_max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">q_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">plot_pq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_ham_field</span><span class="p">(</span>
    <span class="n">L</span><span class="p">,</span> 
    <span class="n">qlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">plim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">density</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_28_0.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_28_1.png">
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/karlicos/.local/lib/python3.7/site-packages/numpy/lib/scimath.py:274: RuntimeWarning: divide by zero encountered in log
  return nx.log(x)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_28_3.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO interesting! look at slope field, this lagrangian is always doomed!!!
TODO what if we continue it to complex plane?
TODO hmm. is the initial position the only thing defining when it dies?? TODO nah, se below, it seems pretty random..
TODO what happens to energy here?? Yep, exactly. when the energy is positive, it's fucked!
TODO figure out how this relates?
TODO it's a funny universe
TODO huh, x log x is 0 when x -&gt; 0
basically, we need to find when slope of the phase plot is 0? so p'(t) = 0</p>
<p>It's interesting though that the flow begs for continuation past the $p = 0$ line. Quick speculation: if you take your momentum as purely complex, you can draw in TODO draw. Not sure if it has any interesting physical, mathematical consequences, so I guess I'll have to look at it some other time (leave visible TODO?).</p>
<p>Let's take a closer look at the stable phase orbits. TODO time flow?</p>

</div>
</div>
</div>





    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_motion</span><span class="p">(</span>
    <span class="n">L</span><span class="p">,</span> 
    <span class="n">q0p0s</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span> <span class="k">for</span> <span class="n">p0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.67</span><span class="p">,</span> <span class="mi">15</span><span class="p">)],</span>
    <span class="n">T_max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">plot_lag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="lagrangians_files/lagrangians_30_0.png">
</div>

</div>

</div>
</div>

</div>





    
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO hmm. interesting that all orbits seem to evolve at the same rate? why is that? definitely need animation...</p>
<p>TODO generate table of contents from tags or something?</p>
<p>TODO summarise what's hard to do. also smth about lagrangians</p>
<p>TODO maybe move it to the end?
It also involved lots of yak shaving:</p>
<ul>
<li>TODO sage/sympy</li>
<li>TODO finding out about symplectic integration</li>
<li>TODO figuring out literate programming in ipython notebooks TODO share hacks later</li>
<li>TODO fighting with emacs in order to render output the way I want it to</li>
</ul>
<p>This post assumes some prior knowledge of TODO</p>
<p>TODO yak shaving
TODO I wanted to figure out what does</p>
<p>spoiler: something called 'regularity', but I still have to figure that out so hopefully will write about it some other time</p>
<p>TODO what I don't like: It's very hard to 'evolve' code over time to let the reader follow your thoughts 
best you can do is copy paste, but that doesn't give you good
perhaps that could be solved if you keep individual functions under git and reference the revisions or something like that, then you would get diffs for free. 
or google-wave like evolution of the whole notebook? However that would be hard to TODO</p>
<p>(you can see that I've defined huge chunks of code in advance)</p>

</div>
</div>
</div>



 


    </section>

    
    <section class="footer">
        <div class="post-tags"><a class="post-tag" href="./tags.html#physics">#physics</a> <a class="post-tag" href="./tags.html#ipython">#ipython</a></div>
        <!-- TODO post-date? -->
        <div class="date">14 April 2019</div>
    </section>
    

    

    <section class="comments">
    <script data-isso="https://beepb00p.xyz/comments/" data-isso-reply-to-self="true" src="https://beepb00p.xyz/comments/js/embed.min.js">
</script>

<section id="isso-thread" data-isso-id="isso_lagrangians"></section>

    </section>

</article>

        </main>

        <!-- TODO hmm maybe display something in a footer, so it's clear it's end of content... -->
        

        <!-- TODO make semantic -->
        <footer>
            <span style="float:left">
            <a href="https://twitter.com/karlicoss">🐦 me @twitter</a>
            ·
            <a href="https://github.com/karlicoss">💻 me @github</a>
            </span>

            <a href="http://creativecommons.org/licenses/by/4.0">CC BY 4.0</a>
            
            
        </footer>
    </body>
</html>
